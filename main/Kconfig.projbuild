menu "Example Configuration"

    orsource "$IDF_PATH/examples/common_components/env_caps/$IDF_TARGET/Kconfig.env_caps"

    choice EXAMPLE_WIFI_CONFIGURATION
        prompt "WiFi configuration"
        default EXAMPLE_WIFI_CONFIGURATION_PROVISIONING
        help
            Choose how the WiFi settings should be configured.

        config EXAMPLE_WIFI_CONFIGURATION_MANUAL
            bool
            prompt "Manual configuration via http server"
        config EXAMPLE_WIFI_CONFIGURATION_PROVISIONING
            bool
            prompt "Using unified provisioning"
    endchoice

    choice EXAMPLE_PROV_SECURITY_VERSION
        bool "Protocomm security version"
        depends on EXAMPLE_WIFI_CONFIGURATION_PROVISIONING
        default EXAMPLE_PROV_SECURITY_VERSION_1
        help
            Network provisioning component offers 3 security versions.
            The example offers a choice between security version 1 and 2.
            You can also choose version 0, which is recommended only
            for testing (not secure, plain text communication)

        config EXAMPLE_PROV_SECURITY_VERSION_1
            bool "Security version 1"
            select ESP_PROTOCOMM_SUPPORT_SECURITY_VERSION_1

        config EXAMPLE_PROV_SECURITY_VERSION_2
            bool "Security version 2"
            select ESP_PROTOCOMM_SUPPORT_SECURITY_VERSION_2

        config EXAMPLE_PROV_SECURITY_VERSION_0
            bool "Plain text communication -- not secure!"
            select ESP_PROTOCOMM_SUPPORT_SECURITY_VERSION_0

    endchoice

    choice EXAMPLE_PROV_MODE
        bool "Security version 2 mode"
        depends on EXAMPLE_PROV_SECURITY_VERSION_2
        default EXAMPLE_PROV_SEC2_DEV_MODE

        config EXAMPLE_PROV_SEC2_DEV_MODE
            bool "Security version 2 development mode"
            depends on EXAMPLE_PROV_SECURITY_VERSION_2
            help
                This enables the development mode for
                security version 2.
                Please note that this mode is NOT recommended for production purpose.

        config EXAMPLE_PROV_SEC2_PROD_MODE
            bool "Security version 2 production mode"
            depends on EXAMPLE_PROV_SECURITY_VERSION_2
            help
                This enables the production mode for
                security version 2.
    endchoice

    choice EXAMPLE_WIRED_INTERFACE
        prompt "Choose the Wired interface"
        default EXAMPLE_WIRED_INTERFACE_IS_ETHERNET
        help
            Choose the wired interface: Ethernet or USB

        config EXAMPLE_WIRED_INTERFACE_IS_ETHERNET
            bool
            prompt "Ethernet"
        config EXAMPLE_WIRED_INTERFACE_IS_USB
            bool
            depends on IDF_TARGET_ESP32S2 || IDF_TARGET_ESP32S3
            prompt "USB NCM"
    endchoice

    config EXAMPLE_RECONFIGURE_BUTTON
        int "Button for switching to reconfigure mode"
        range ENV_GPIO_RANGE_MIN ENV_GPIO_IN_RANGE_MAX
        default 2 if EXAMPLE_WIRED_INTERFACE_IS_ETHERNET
        default 0
        help
            The button on this GPIO is used to reset the board to
            the reconfiguration mode, i.e. to restart provisioning
            or manual configuration of Wi-Fi settings (ssid, password)

    if EXAMPLE_WIRED_INTERFACE_IS_ETHERNET

        config EXAMPLE_MODIFY_DHCP_MESSAGES
            bool "Modify DHCP messages"
            default y
            help
                This is needed if the client uses 61 option and the DHCP server applies strict rules
                on assigning addresses.
                Set this to 'n' if you don't need DHCP or you're using simplified DHCP workflow
                without HW address options in DHCP messages.

        config EXAMPLE_ETHERNET_USE_PROMISCUOUS
            bool "Enable promiscuous mode on Ethernet interface"
            default n
            help
                Enable promiscuous mode on the Ethernet interface.
                Note: Enabling promiscuous mode results in better throughput as MAC addresses
                in frames are not rewritten with the Ethernet interface's actual MAC address.
                Note: Enabling promiscuous mode may cause ARP conflicts if the PC
                is also connected to the same network with another NIC.
    endif

endmenu

menu "SDIO & WiFi Remote Optimization"

    config SDIO_TX_TIMEOUT_MS
        int "SDIO TX timeout in milliseconds"
        range 10 1000
        default 100
        help
            Timeout for SDIO transmit operations. If the SDIO interface does not
            respond within this time, the operation will fail and allow the system
            to recover rather than blocking indefinitely.
            Recommended: 100ms for normal operation, increase to 200-300ms for
            debugging or if experiencing frequent timeouts.

    config SDIO_RETRY_MAX_COUNT
        int "Maximum SDIO TX retry count"
        range 1 50
        default 5
        help
            Maximum number of times to retry SDIO transmit operations before giving up.
            Lower values (3-5) prevent long blocking periods and allow faster error detection.
            Higher values (10-20) may improve reliability on unstable connections but can
            cause longer stalls if SDIO is truly blocked.
            Note: Total worst-case delay = SDIO_RETRY_MAX_COUNT * SDIO_RETRY_DELAY_MS

    config SDIO_RETRY_DELAY_MS
        int "Delay between SDIO TX retries in milliseconds"
        range 1 50
        default 5
        help
            Delay between consecutive SDIO transmit retry attempts.
            Higher values reduce CPU usage but increase latency on transient failures.
            Recommended: 5ms for balanced performance.

    config SDIO_RETRY_EXPONENTIAL_BACKOFF
        bool "Use exponential backoff for SDIO retries"
        default y
        help
            Enable exponential backoff for SDIO retry delays. The delay will increase
            exponentially with each retry: delay, 2*delay, 4*delay, etc.
            This reduces bus contention and improves recovery from SDIO stalls.
            Maximum delay is capped at 50ms regardless of backoff calculation.

    config SDIO_HEALTH_CHECK_ENABLE
        bool "Enable SDIO health monitoring"
        default y
        help
            Enable a watchdog task that monitors SDIO activity and detects stalls.
            If SDIO is idle for longer than the configured threshold, a warning
            will be logged. This helps diagnose SDIO blocking issues.

    config SDIO_HEALTH_CHECK_INTERVAL_MS
        int "SDIO health check interval in milliseconds"
        depends on SDIO_HEALTH_CHECK_ENABLE
        range 1000 30000
        default 5000
        help
            How often the SDIO health monitoring task checks for stalls.
            Recommended: 5000ms (5 seconds) for production.

    config SDIO_HEALTH_CHECK_STALL_THRESHOLD_MS
        int "SDIO stall detection threshold in milliseconds"
        depends on SDIO_HEALTH_CHECK_ENABLE
        range 5000 60000
        default 10000
        help
            If SDIO has been idle (no TX activity) for this duration, it will be
            flagged as potentially stalled. Should be at least 2x the normal
            expected idle time during operation.
            Recommended: 10000ms (10 seconds).

    config SDIO_VERBOSE_LOGGING
        bool "Enable verbose SDIO debug logging"
        default n
        help
            Enable detailed logging of SDIO operations, including:
            - Every TX attempt and result
            - Retry counts and delays
            - Health check status
            - Buffer queue depths
            Warning: This generates significant log output and may impact performance.
            Recommended only for debugging SDIO issues.

    config WIFI_REMOTE_TX_TASK_PRIORITY
        int "WiFi remote TX task priority"
        range 1 25
        default 10
        help
            Priority of the Ethernet-to-WiFi packet forwarding task.
            Higher values give more CPU time but may starve other tasks.
            Default: 10 (high priority for low latency)

    config WIFI_REMOTE_RX_TASK_PRIORITY
        int "WiFi remote RX task priority"
        range 1 25
        default 10
        help
            Priority of the WiFi-to-Ethernet packet forwarding task.
            Higher values give more CPU time but may starve other tasks.
            Default: 10 (high priority for low latency)

    config PACKET_QUEUE_POLL_INTERVAL_MS
        int "Packet queue polling interval in milliseconds"
        range 1 100
        default 1
        help
            When packet queues are empty, tasks will delay for this duration
            before checking again. Lower values reduce latency but increase
            CPU usage. Higher values reduce CPU usage but may increase latency.
            Recommended: 1ms for low latency, 5-10ms for lower CPU usage.

endmenu
